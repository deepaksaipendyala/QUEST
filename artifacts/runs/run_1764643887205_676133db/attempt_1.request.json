{
  "repo": "django/django",
  "version": "4.1",
  "code_file": "django/views/static.py",
  "test_src": "import mimetypes\nimport tempfile\nfrom pathlib import Path\nfrom django.http import Http404, HttpResponseNotModified\nfrom django.test import SimpleTestCase\nfrom django.utils.http import http_date\nfrom django.utils.translation import gettext as _\n\nfrom django.views.static import serve, directory_index, was_modified_since\n\nclass StaticFileServeTests(SimpleTestCase):\n\n    def setUp(self):\n        self.temp_dir = tempfile.TemporaryDirectory()\n        self.document_root = Path(self.temp_dir.name)\n        self.file_path = self.document_root / \"test_file.txt\"\n        self.file_path.write_text(\"This is a test file.\")\n        self.directory_path = self.document_root / \"test_directory\"\n        self.directory_path.mkdir()\n        self.directory_index_template = self.document_root / \"static/directory_index.html\"\n        self.directory_index_template.parent.mkdir(parents=True, exist_ok=True)\n        self.directory_index_template.write_text(\"<html><body>Index of {{ directory }}</body></html>\")\n\n    def tearDown(self):\n        self.temp_dir.cleanup()\n\n    def test_serve_valid_file(self):\n        response = serve(None, \"test_file.txt\", document_root=self.document_root)\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(response.content.decode(), \"This is a test file.\")\n        self.assertEqual(response.headers[\"Content-Type\"], \"text/plain\")\n        self.assertEqual(response.headers[\"Last-Modified\"], http_date(self.file_path.stat().st_mtime))\n\n    def test_serve_missing_file(self):\n        with self.assertRaises(Http404):\n            serve(None, \"missing_file.txt\", document_root=self.document_root)\n\n    def test_serve_directory_with_show_indexes(self):\n        response = serve(None, \"test_directory\", document_root=self.document_root, show_indexes=True)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(b\"Index of test_directory\", response.content)\n\n    def test_serve_directory_without_show_indexes(self):\n        with self.assertRaises(Http404):\n            serve(None, \"test_directory\", document_root=self.document_root, show_indexes=False)\n\n    def test_serve_if_modified_since(self):\n        header = \"Wed, 21 Oct 2015 07:28:00 GMT\"\n        response = serve(None, \"test_file.txt\", document_root=self.document_root)\n        self.assertEqual(response.status_code, 200)\n\n        # Simulate If-Modified-Since header\n        self.file_path.touch()  # Update the file's modification time\n        response = serve({\"META\": {\"HTTP_IF_MODIFIED_SINCE\": header}}, \"test_file.txt\", document_root=self.document_root)\n        self.assertIsInstance(response, HttpResponseNotModified)\n\n    def test_directory_index(self):\n        response = directory_index(\"test_directory\", self.directory_path)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(b\"Index of test_directory\", response.content)\n\n    def test_directory_index_template_not_exist(self):\n        self.directory_index_template.unlink()  # Remove the template to trigger fallback\n        response = directory_index(\"test_directory\", self.directory_path)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(b\"Index of test_directory\", response.content)\n\n    def test_was_modified_since(self):\n        self.assertTrue(was_modified_since(None, 0, 0))\n        self.assertTrue(was_modified_since(\"Wed, 21 Oct 2015 07:28:00 GMT\", 0, 0))\n        self.assertFalse(was_modified_since(\"Wed, 21 Oct 2015 07:28:00 GMT\", 1, 0))\n        self.assertRaises(ValueError, was_modified_since, \"invalid_header\", 0, 0)\n\n    def test_serve_empty_file(self):\n        empty_file_path = self.document_root / \"empty_file.txt\"\n        empty_file_path.write_text(\"\")\n        response = serve(None, \"empty_file.txt\", document_root=self.document_root)\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(response.content.decode(), \"\")\n        self.assertEqual(response.headers[\"Content-Type\"], \"text/plain\")\n\n    def test_serve_invalid_file_type(self):\n        invalid_file_path = self.document_root / \"invalid_file.xyz\"\n        invalid_file_path.write_text(\"This is an invalid file type.\")\n        response = serve(None, \"invalid_file.xyz\", document_root=self.document_root)\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(response.content.decode(), \"This is an invalid file type.\")\n        self.assertEqual(response.headers[\"Content-Type\"], \"text/plain\")\n\n    def test_serve_none_file(self):\n        with self.assertRaises(Http404):\n            serve(None, None, document_root=self.document_root)\n\n    def test_was_modified_since_invalid_date(self):\n        with self.assertRaises(ValueError):\n            was_modified_since(\"invalid_date\", 0, 0)"
}