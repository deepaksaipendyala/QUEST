{
  "repo": "django/django",
  "version": "4.1",
  "code_file": "django/views/static.py",
  "test_src": "import mimetypes\nimport tempfile\nimport unittest\nfrom pathlib import Path\nfrom django.http import Http404, HttpResponseNotModified, FileResponse\nfrom django.views.static import serve, directory_index, was_modified_since\n\nclass StaticFileServeTests(unittest.TestCase):\n\n    def setUp(self):\n        self.temp_dir = tempfile.TemporaryDirectory()\n        self.document_root = Path(self.temp_dir.name)\n        self.file_path = self.document_root / \"test_file.txt\"\n        self.file_path.write_text(\"This is a test file.\")\n        self.directory_path = self.document_root / \"test_dir\"\n        self.directory_path.mkdir()\n        self.index_file_path = self.directory_path / \"index.html\"\n        self.index_file_path.write_text(\"This is an index file.\")\n\n    def tearDown(self):\n        self.temp_dir.cleanup()\n\n    def test_serve_valid_file(self):\n        response = serve(None, \"test_file.txt\", document_root=self.document_root)\n        self.assertIsInstance(response, FileResponse)\n        self.assertEqual(response.status_code, 200)\n        self.assertEqual(response.content.decode(), \"This is a test file.\")\n        self.assertIn(\"Last-Modified\", response.headers)\n\n    def test_serve_missing_file(self):\n        with self.assertRaises(Http404):\n            serve(None, \"missing_file.txt\", document_root=self.document_root)\n\n    def test_serve_directory_with_show_indexes(self):\n        response = serve(None, \"test_dir\", document_root=self.document_root, show_indexes=True)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(\"<h1>Index of test_dir</h1>\", response.content.decode())\n\n    def test_serve_directory_without_show_indexes(self):\n        with self.assertRaises(Http404):\n            serve(None, \"test_dir\", document_root=self.document_root, show_indexes=False)\n\n    def test_serve_directory_index_template(self):\n        response = directory_index(\"test_dir\", self.directory_path)\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(\"Index of test_dir\", response.content.decode())\n        self.assertIn(\"index.html\", response.content.decode())\n\n    def test_serve_directory_index_template_no_template(self):\n        response = directory_index(\"nonexistent_dir\", Path(self.document_root / \"nonexistent_dir\"))\n        self.assertEqual(response.status_code, 200)\n        self.assertIn(\"Index of nonexistent_dir\", response.content.decode())\n\n    def test_was_modified_since(self):\n        header = \"Wed, 21 Oct 2015 07:28:00 GMT; length=20\"\n        mtime = self.file_path.stat().st_mtime\n        size = self.file_path.stat().st_size\n        self.assertFalse(was_modified_since(header, mtime, size))\n\n    def test_was_modified_since_not_modified(self):\n        header = \"Wed, 21 Oct 2015 07:28:00 GMT; length=20\"\n        mtime = self.file_path.stat().st_mtime + 1000  # Simulate a newer file\n        size = self.file_path.stat().st_size\n        self.assertTrue(was_modified_since(header, mtime, size))\n\n    def test_was_modified_since_invalid_header(self):\n        self.assertTrue(was_modified_since(\"invalid_header\", 0, 0))\n\n    def test_was_modified_since_no_header(self):\n        self.assertTrue(was_modified_since(None, 0, 0))"
}