{
  "repo": "django/django",
  "version": "4.0",
  "code_file": "django/db/models/query_utils.py",
  "test_src": "import tempfile\nimport unittest\nfrom django.core.exceptions import FieldError\nfrom django.db.models.query_utils import Q, select_related_descend, FilteredRelation, check_rel_lookup_compatibility\n\nclass QueryUtilsTests(unittest.TestCase):\n\n    def test_q_combination_and(self):\n        q1 = Q(name='test')\n        q2 = Q(age=30)\n        combined = q1 & q2\n        self.assertTrue(isinstance(combined, Q))\n        self.assertEqual(combined.connector, Q.AND)\n\n    def test_q_combination_or(self):\n        q1 = Q(name='test')\n        q2 = Q(age=30)\n        combined = q1 | q2\n        self.assertTrue(isinstance(combined, Q))\n        self.assertEqual(combined.connector, Q.OR)\n\n    def test_q_negation(self):\n        q = Q(name='test')\n        negated = ~q\n        self.assertTrue(isinstance(negated, Q))\n        self.assertTrue(negated.negated)\n\n    def test_deconstruct_q(self):\n        q = Q(name='test', age=30)\n        path, args, kwargs = q.deconstruct()\n        self.assertIn('django.db.models.query_utils.Q', path)\n        self.assertEqual(args, ('test', 30))\n        self.assertEqual(kwargs, {})\n\n    def test_select_related_descend(self):\n        field = unittest.mock.Mock()\n        field.remote_field = unittest.mock.Mock()\n        field.remote_field.parent_link = False\n        field.name = 'related_field'\n        field.null = False\n\n        self.assertTrue(select_related_descend(field, False, {'related_field': True}, set(), False))\n        self.assertFalse(select_related_descend(field, True, {'other_field': True}, set(), False))\n\n    def test_filtered_relation_init(self):\n        with self.assertRaises(ValueError):\n            FilteredRelation('', condition=Q())\n\n    def test_filtered_relation_condition(self):\n        fr = FilteredRelation('relation_name', condition=Q(name='test'))\n        self.assertEqual(fr.relation_name, 'relation_name')\n        self.assertEqual(fr.condition, Q(name='test'))\n\n    def test_check_rel_lookup_compatibility(self):\n        model = unittest.mock.Mock()\n        target_opts = unittest.mock.Mock()\n        field = unittest.mock.Mock()\n        field.primary_key = False\n\n        model._meta.concrete_model = target_opts.concrete_model = 'TestModel'\n        self.assertTrue(check_rel_lookup_compatibility(model, target_opts, field))\n\n        field.primary_key = True\n        self.assertTrue(check_rel_lookup_compatibility(model, target_opts, field))\n\n    def test_filtered_relation_eq(self):\n        fr1 = FilteredRelation('relation_name', condition=Q(name='test'))\n        fr2 = FilteredRelation('relation_name', condition=Q(name='test'))\n        self.assertEqual(fr1, fr2)\n\n    def test_filtered_relation_clone(self):\n        fr = FilteredRelation('relation_name', condition=Q(name='test'))\n        clone = fr.clone()\n        self.assertEqual(fr, clone)\n        self.assertIsNot(fr, clone)\n\nif __name__ == '__main__':\n    unittest.main()"
}