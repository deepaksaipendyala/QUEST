{
  "repo": "django/django",
  "version": "4.2",
  "code_file": "django/utils/numberformat.py",
  "test_src": "from decimal import Decimal\nfrom django.conf import settings\nfrom django.utils.safestring import mark_safe\nfrom django.test import SimpleTestCase\n\ndef format(\n    number,\n    decimal_sep,\n    decimal_pos=None,\n    grouping=0,\n    thousand_sep=\"\",\n    force_grouping=False,\n    use_l10n=None,\n):\n    if number is None or number == \"\":\n        return mark_safe(number)\n    use_grouping = (\n        use_l10n or (use_l10n is None and settings.USE_L10N)\n    ) and settings.USE_THOUSAND_SEPARATOR\n    use_grouping = use_grouping or force_grouping\n    use_grouping = use_grouping and grouping != 0\n    if isinstance(number, int) and not use_grouping and not decimal_pos:\n        return mark_safe(number)\n    sign = \"\"\n    if isinstance(number, float) and \"e\" in str(number).lower():\n        number = Decimal(str(number))\n    if isinstance(number, Decimal):\n        if decimal_pos is not None:\n            cutoff = Decimal(\"0.\" + \"1\".rjust(decimal_pos, \"0\"))\n            if abs(number) < cutoff:\n                number = Decimal(\"0\")\n        _, digits, exponent = number.as_tuple()\n        if abs(exponent) + len(digits) > 200:\n            number = \"{:e}\".format(number)\n            coefficient, exponent = number.split(\"e\")\n            coefficient = format(\n                coefficient,\n                decimal_sep,\n                decimal_pos,\n                grouping,\n                thousand_sep,\n                force_grouping,\n                use_l10n,\n            )\n            return \"{}e{}\".format(coefficient, exponent)\n        else:\n            str_number = \"{:f}\".format(number)\n    else:\n        str_number = str(number)\n    if str_number[0] == \"-\":\n        sign = \"-\"\n        str_number = str_number[1:]\n    if \".\" in str_number:\n        int_part, dec_part = str_number.split(\".\")\n        if decimal_pos is not None:\n            dec_part = dec_part[:decimal_pos]\n    else:\n        int_part, dec_part = str_number, \"\"\n    if decimal_pos is not None:\n        dec_part = dec_part + (\"0\" * (decimal_pos - len(dec_part)))\n    dec_part = dec_part and decimal_sep + dec_part\n    if use_grouping:\n        try:\n            intervals = list(grouping)\n        except TypeError:\n            intervals = [grouping, 0]\n        active_interval = intervals.pop(0)\n        int_part_gd = \"\"\n        cnt = 0\n        for digit in int_part[::-1]:\n            if cnt and cnt == active_interval:\n                if intervals:\n                    active_interval = intervals.pop(0) or active_interval\n                int_part_gd += thousand_sep[::-1]\n                cnt = 0\n            int_part_gd += digit\n            cnt += 1\n        int_part = int_part_gd[::-1]\n    return sign + int_part + dec_part\n\nclass NumberFormatTests(SimpleTestCase):\n    def test_format_none(self):\n        result = format(None, \".\", 2)\n        self.assertEqual(result, mark_safe(None))\n\n    def test_format_empty_string(self):\n        result = format(\"\", \".\", 2)\n        self.assertEqual(result, mark_safe(\"\"))\n\n    def test_format_integer_without_grouping(self):\n        result = format(123456, \".\", None, 0)\n        self.assertEqual(result, mark_safe(123456))\n\n    def test_format_integer_with_grouping(self):\n        result = format(1234567, \".\", None, 3, \",\")\n        self.assertEqual(result, mark_safe(\"1,234,567\"))\n\n    def test_format_float(self):\n        result = format(1234.5678, \".\", 2)\n        self.assertEqual(result, mark_safe(\"1234.57\"))\n\n    def test_format_decimal(self):\n        result = format(Decimal('1234.5678'), \".\", 2)\n        self.assertEqual(result, mark_safe(\"1234.57\"))\n\n    def test_format_large_decimal(self):\n        result = format(Decimal('1e+300'), \".\", None)\n        self.assertEqual(result, mark_safe(\"1e+300\"))\n\n    def test_format_small_decimal(self):\n        result = format(Decimal('0.00001'), \".\", 2)\n        self.assertEqual(result, mark_safe(\"0.00\"))\n\n    def test_format_negative_integer(self):\n        result = format(-123456, \".\", None, 0)\n        self.assertEqual(result, mark_safe(\"-123456\"))\n\n    def test_format_negative_float(self):\n        result = format(-1234.5678, \".\", 2)\n        self.assertEqual(result, mark_safe(\"-1234.57\"))\n\n    def test_format_with_thousand_separator(self):\n        result = format(1234567.89, \".\", 2, 3, \",\")\n        self.assertEqual(result, mark_safe(\"1,234,567.89\"))\n\n    def test_format_with_custom_decimal_and_thousand_separator(self):\n        result = format(1234567.89, \",\", 2, 3, \".\")\n        self.assertEqual(result, mark_safe(\"1.234.567,89\"))\n\n    def test_format_with_force_grouping(self):\n        result = format(1234567, \".\", None, 3, \",\", force_grouping=True)\n        self.assertEqual(result, mark_safe(\"1,234,567\"))\n\n    def test_format_with_use_l10n(self):\n        settings.USE_L10N = True\n        settings.USE_THOUSAND_SEPARATOR = True\n        result = format(1234567.89, \".\", 2, 3, \",\", use_l10n=True)\n        self.assertEqual(result, mark_safe(\"1,234,567.89\"))"
}