{
  "repo": "django/django",
  "version": "3.1",
  "code_file": "django/db/models/lookups.py",
  "test_src": "from django.test import SimpleTestCase\nfrom django.db.models import IntegerField, Field\nfrom django.db.models.expressions import Value\nfrom django.core.exceptions import EmptyResultSet\nfrom django.db.models.sql.query import Query\nfrom django.utils.datastructures import OrderedSet\nimport tempfile\nimport pathlib\n\nclass LookupTests(SimpleTestCase):\n\n    def setUp(self):\n        self.lhs = IntegerField()\n        self.rhs = Value(10)\n\n    def test_exact_lookup(self):\n        lookup = Exact(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'exact')\n\n    def test_iexact_lookup(self):\n        lookup = IExact(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'iexact')\n\n    def test_greater_than_lookup(self):\n        lookup = GreaterThan(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'gt')\n\n    def test_greater_than_or_equal_lookup(self):\n        lookup = GreaterThanOrEqual(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'gte')\n\n    def test_less_than_lookup(self):\n        lookup = LessThan(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'lt')\n\n    def test_less_than_or_equal_lookup(self):\n        lookup = LessThanOrEqual(self.lhs, self.rhs)\n        self.assertEqual(lookup.lookup_name, 'lte')\n\n    def test_in_lookup_with_empty_rhs(self):\n        lookup = In(self.lhs, [])\n        with self.assertRaises(EmptyResultSet):\n            lookup.process_rhs(None, None)\n\n    def test_in_lookup_with_valid_rhs(self):\n        lookup = In(self.lhs, [1, 2, 3])\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('IN', sql)\n\n    def test_contains_lookup(self):\n        lookup = Contains(self.lhs, 'test')\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('LIKE', sql)\n\n    def test_startswith_lookup(self):\n        lookup = StartsWith(self.lhs, 'test')\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('LIKE', sql)\n\n    def test_endswith_lookup(self):\n        lookup = EndsWith(self.lhs, 'test')\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('LIKE', sql)\n\n    def test_isnull_lookup(self):\n        lookup = IsNull(self.lhs, True)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('IS NULL', sql)\n\n    def test_regex_lookup(self):\n        lookup = Regex(self.lhs, r'\\d+')\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('REGEXP', sql)\n\n    def test_iregex_lookup(self):\n        lookup = IRegex(self.lhs, r'\\d+')\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('REGEXP', sql)\n\n    def test_year_exact_lookup(self):\n        lookup = YearExact(self.lhs, 2021)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('BETWEEN', sql)\n\n    def test_year_gt_lookup(self):\n        lookup = YearGt(self.lhs, 2021)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('>', sql)\n\n    def test_year_gte_lookup(self):\n        lookup = YearGte(self.lhs, 2021)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('>=', sql)\n\n    def test_year_lt_lookup(self):\n        lookup = YearLt(self.lhs, 2021)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('<', sql)\n\n    def test_year_lte_lookup(self):\n        lookup = YearLte(self.lhs, 2021)\n        sql, params = lookup.as_sql(None, None)\n        self.assertIn('<=', sql)\n\n    def test_batch_process_rhs_with_iterable(self):\n        lookup = FieldGetDbPrepValueIterableMixin()\n        sqls, params = lookup.batch_process_rhs(None, None, rhs=[1, 2, 3])\n        self.assertEqual(len(params), 3)\n\n    def test_batch_process_rhs_with_non_iterable(self):\n        lookup = FieldGetDbPrepValueIterableMixin()\n        sqls, params = lookup.batch_process_rhs(None, None, rhs=1)\n        self.assertEqual(len(params), 1)\n\n    def test_process_rhs_with_query(self):\n        query = Query()\n        lookup = Exact(self.lhs, query)\n        with self.assertRaises(ValueError):\n            lookup.process_rhs(None, None)\n\n    def test_process_rhs_with_valid_query(self):\n        query = Query()\n        query.add_fields(['pk'])\n        lookup = Exact(self.lhs, query)\n        sql, params = lookup.process_rhs(None, None)\n        self.assertIn('SELECT', sql)\n\n    def test_process_rhs_with_invalid_query(self):\n        query = Query()\n        lookup = Exact(self.lhs, query)\n        with self.assertRaises(ValueError):\n            lookup.process_rhs(None, None)\n\n    def test_get_db_prep_lookup_with_iterable(self):\n        lookup = FieldGetDbPrepValueIterableMixin()\n        result = lookup.get_db_prep_lookup([1, 2, 3], None)\n        self.assertEqual(len(result[1]), 3)\n\n    def test_get_db_prep_lookup_with_non_iterable(self):\n        lookup = FieldGetDbPrepValueMixin()\n        result = lookup.get_db_prep_lookup(1, None)\n        self.assertEqual(len(result[1]), 1)"
}